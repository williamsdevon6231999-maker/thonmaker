trigger:
- main

pool:
  name: SelfHostedWindows

steps:
- powershell: |
    docker build -t thonmaker:$(Build.BuildId) .
    docker rm -f thonmaker_test 2>$null
    docker run -d --name thonmaker_test -p 8000:8000 thonmaker:$(Build.BuildId)
    Start-Sleep -Seconds 3
    Invoke-WebRequest http://localhost:8000/ -UseBasicParsing
  displayName: Build and smoke test Docker container
